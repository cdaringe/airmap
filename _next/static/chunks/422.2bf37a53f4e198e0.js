"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{1988:function(t,r,n){n.d(r,{Ok:function(){return i},Hw:function(){return c},e5:function(){return u}});var e=n(5624);function a(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!r||n.length!==r);e=!0);}catch(c){a=!0,o=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(t){return function(t){if(Array.isArray(t)){for(var r=0,n=new Array(t.length);r<t.length;r++)n[r]=t[r];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(t){try{var r=new URL(t),n=a(r.pathname.substr(1).split("/"),3),e=n[0],o=n[1],i=n[2];if("spreadsheets"===e&&"d"===o&&i&&r.host.match("google.com"))return!0}catch(u){}return!1}function u(t){var r=new URL(t);return r.pathname=o(r.pathname.substr(1).split("/").splice(0,3)).concat(["export"]).join("/"),String(r)}var c=function(t){var r=new URL(t),n=new URLSearchParams(r.search);return n.has("format")||n.set("format","csv"),r.search=n.toString(),function(t,r){return fetch(t,r).then((function(t){return t.body})).then((function(t){var r=null===t||void 0===t?void 0:t.getReader();return(0,e.k)(r,"missing stream body"),r}))}(u(r.toString()),{mode:"cors",redirect:"follow",headers:{accept:"text"}})}},8677:function(t,r,n){function e(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!r||n.length!==r);e=!0);}catch(c){a=!0,o=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(r,{q:function(){return a}});var a=function(t){return function(r){var n=e(r,2),a=n[0],o=n[1];return["all",[">=",t,a],["<",t,o]]}}},6422:function(t,r,n){n.r(r),n.d(r,{getResources:function(){return T}});var e={};n.r(e),n.d(e,{getLevels:function(){return _},getLevelsByField:function(){return M},getLevelsSub500nm:function(){return E}});var a=n(4235),o=n.n(a),i=n(1988),u=n(5624);function c(t,r,n,e,a,o,i){try{var u=t[o](i),c=u.value}catch(l){return void n(l)}u.done?r(c):Promise.resolve(c).then(e,a)}function l(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!r||n.length!==r);e=!0);}catch(c){a=!0,o=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f,s=function(t){return new Date(t.trim().split(" ").map((function(t,r){if(0===r){var n=l(t.split("/"),3),e=n[0],a=n[1],o=n[2],i=function(t){return 1===t.length?"0".concat(t):t};return"".concat(e,"-").concat(i(a),"-").concat(i(o))}return"T".concat(t,".000-07:00")})).join(""))},d=function(t){return parseFloat(t)},p=(f=o().mark((function t(r,n){var e,a,i,c,l,f;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=void 0===n?{records:[],partial:"",particleDiametersAscending:[]}:n,t.next=3,r.read();case 3:return a=t.sent,i=a.done,((c=a.value)||i)&&(e.partial+="string"===typeof c?c:c?(new TextDecoder).decode(c):"",l=e.partial.split(/\n/g),f=l.length-1,l.forEach((function(t,r){if(f!==r||i){var n=t.split(",");if(e.headerIndiciesByName){var a=n[e.headerIndiciesByName.Time],o=n[e.headerIndiciesByName["pm2.5 [ug/m3]"]];(0,u.k)(a,"date missing"),(0,u.k)(Number.isFinite(o),"column 'pm2.5 [ug/m3]' missing");for(var c=0,l=e.headerIndiciesByName["10.00 nm"],p=e.headerIndiciesByName["449.48 nm"],m=0;l<p;){var y=parseFloat(n[l]),v=(e.particleDiametersAscending[m]+e.particleDiametersAscending[m+1])/2;c+=(h=y,g=v,Math.PI/6*Math.pow(g/1e9,3)*1800*h/.0012/1e9),++m,++l}e.records.push({date:s(a),sub500nm:c,pm_2_5:d(o)}),i&&(e.partial="")}else e.headerIndiciesByName=n.reduce((function(t,r,n){var a=r.trim();t[a]=n;var o=a.match(/\s*(\d+\.\d+)\s+nm/);return o&&e.particleDiametersAscending.push(parseInt(o[1],10)),t}),{})}else e.partial=t;var h,g}))),t.abrupt("return",i?e:p(r,e));case 8:case"end":return t.stop()}}),t)})),function(){var t=this,r=arguments;return new Promise((function(n,e){var a=f.apply(t,r);function o(t){c(a,n,e,o,i,"next",t)}function i(t){c(a,n,e,o,i,"throw",t)}o(void 0)}))}),m=n(3415);function y(t,r,n,e,a,o,i){try{var u=t[o](i),c=u.value}catch(l){return void n(l)}u.done?r(c):Promise.resolve(c).then(e,a)}function v(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function h(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),e.forEach((function(r){v(t,r,n[r])}))}return t}function g(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!r||n.length!==r);e=!0);}catch(c){a=!0,o=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var b=function(t){var r=function(t){return function(){var r=this,n=arguments;return new Promise((function(e,a){var o=t.apply(r,n);function i(t){y(o,e,a,i,u,"next",t)}function u(t){y(o,e,a,i,u,"throw",t)}i(void 0)}))}}(o().mark((function r(n){var e,a,c,l,f,s,d,y,v;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=g(n,2),a=e[0],c=e[1],(0,u.k)(a,""),(0,u.k)(c,""),r.t0=g,r.next=6,Promise.all([(0,i.Hw)(a).then(p),(0,i.Hw)(c).then(m.Q)]);case 6:return r.t1=r.sent,l=(0,r.t0)(r.t1,2),f=l[0],s=f.records,d=l[1],y=d.records,s.length!==y.length&&console.warn("lossy data - measures ".concat(s.length,", positions ").concat(y.length)),v=y.map((function(t){return t.date})),r.abrupt("return",s.reduce((function(r,n){var e=t.closestTo(n.date,v),a=y.find((function(t){return t.date.getTime()===e.getTime()}));if(!a)throw new Error("no position found for ".concat(JSON.stringify(n)));var o=h({},n,{latitude:a.latitude,longitude:a.longitude,humidity:a.humidity,pocketlabsEntry:a,skip:Math.abs(a.date.getTime()-n.date.getTime())>6e4});return o.skip||r.push(o),r}),[]));case 15:case"end":return r.stop()}}),r)}))),n=function(t){return{type:"FeatureCollection",features:t.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:[t.longitude,t.latitude]},properties:h({},t)}}))}};return{download:r,downloadGeoJSON:function(t){return r(t).then(n)},dateField:"date",toGeoJSON:n}},w=n(8677);function A(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function O(t){return function(t){if(Array.isArray(t)){for(var r=0,n=new Array(t.length);r<t.length;r++)n[r]=t[r];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var S,j=["#6fc400","#feff00","#ffaa00","#ff5600","#991113","#4d0173","black"],P="pm_2_5",x="sub500nm",N=[0,.25,.5,1,2.5,5,20].map((function(t,r,n){return[t,n[r+1]||1/0]})),k=["get",P],I=["get",x],_=function(t){var r=t.isMinMaxDynamicRange,n=t.geojson,e=0,a=1/0,o=-1/0,i=!0,u=!1,c=void 0;try{for(var l,f=n.features[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){(e=l.value.properties.pm_2_5)>o&&(o=e),e<a&&(a=e)}}catch(m){u=!0,c=m}finally{try{i||null==f.return||f.return()}finally{if(u)throw c}}var s=j.length,d=r?(o-a)/s:0,p=r?O(new Array(s)).map((function(t,r){var n=a+r*d;return[n,n+d]})):N;return{circleCases:p.map((0,w.q)(k)).flatMap((function(t,r){return[t,j[r]]})),colors:j,fieldName:P,ranges:p}},E=function(t){var r=t.isMinMaxDynamicRange,n=t.geojson,e=0,a=1/0,o=-1/0,i=!0,u=!1,c=void 0;try{for(var l,f=n.features[Symbol.iterator]();!(i=(l=f.next()).done);i=!0){(e=l.value.properties.sub500nm)>o&&(o=e),e<a&&(a=e)}}catch(m){u=!0,c=m}finally{try{i||null==f.return||f.return()}finally{if(u)throw c}}var s=j.length,d=r?(o-a)/s:0,p=r?O(new Array(s)).map((function(t,r){var n=a+r*d;return[n,n+d]})):N;return{circleCases:p.map((0,w.q)(I)).flatMap((function(t,r){return[t,j[r]]})),colors:j,fieldName:x,ranges:p}},M=(A(S={},P,_),A(S,x,E),S),T=function(t){return{download:b(t),mapbox:e}}},3415:function(t,r,n){n.d(r,{Q:function(){return A}});var e,a,o=n(4235),i=n.n(o);function u(t,r,n,e,a,o,i){try{var u=t[o](i),c=u.value}catch(l){return void n(l)}u.done?r(c):Promise.resolve(c).then(e,a)}function c(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function l(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),e.forEach((function(r){c(t,r,n[r])}))}return t}function f(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!r||n.length!==r);e=!0);}catch(c){a=!0,o=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(t){return function(t){if(Array.isArray(t)){for(var r=0,n=new Array(t.length);r<t.length;r++)n[r]=t[r];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(t,r){if(null===t||void 0===t)throw Error(r)}var p,m=new Set(s(["Date","Lat","Lng","PM1.0 (\xb5g/m\xb3)","PM2.5 (\xb5g/m\xb3)","t (s)"]).concat(s(["Lat","Lng","t (s)","Relative Humidity (%)"]))),y={Date:"date",Lat:"latitude",Lng:"longitude","t (s)":"counter_t","PM1.0 (\xb5g/m\xb3)":"pm_1_0","PM2.5 (\xb5g/m\xb3)":"pm_2_5","Relative Humidity (%)":"humidity"},v={Date:function(t){return new Date(t)},Lat:parseFloat,Lng:parseFloat,"t (s)":function(t){return parseInt(t)},"PM1.0 (\xb5g/m\xb3)":parseFloat,"PM2.5 (\xb5g/m\xb3)":parseFloat,"Relative Humidity (%)":parseFloat},h=["a","A","z","Z"],g=(e=Math).min.apply(e,s(h.map((function(t){return t.charCodeAt(0)})))),b=(a=Math).max.apply(a,s(h.map((function(t){return t.charCodeAt(0)})))),w=function(t){var r=t.charCodeAt(0);return g<=r&&r<=b},A=(p=i().mark((function t(r,n){var e,a,o,u,s,p;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=void 0===n?{headerIndiciesByName:{},partial:"",records:[]}:n,t.next=3,r.read();case 3:return a=t.sent,o=a.done,u=a.value,e.partial+="string"===typeof u?u:u?(new TextDecoder).decode(u):"",s=e.partial.split(/\n/g),p=s.length-1,s.forEach((function(t,r){if(p!==r||o){var n=t.split(",");if(w(t[0]||""))e.headerIndiciesByName=n.reduce((function(t,r,n){return m.has(r)?l({},t,c({},r,n)):t}),{});else if(""===n[0]);else{var a=Object.entries(e.headerIndiciesByName).reduce((function(t,r){var e=f(r,2),a=e[0],o=e[1];return l({},t,c({},y[a],v[a](n[o])))}),{});d(!Number.isNaN(a.counter_t),"NaN"),d(Number.isFinite(a.counter_t),"t (s) not ok"),e.records[a.counter_t]=l({},e.records[a.counter_t]||{},a),o&&(e.partial="")}}else e.partial=t})),t.abrupt("return",o?e:A(r,e));case 11:case"end":return t.stop()}}),t)})),function(){var t=this,r=arguments;return new Promise((function(n,e){var a=p.apply(t,r);function o(t){u(a,n,e,o,i,"next",t)}function i(t){u(a,n,e,o,i,"throw",t)}o(void 0)}))})},5624:function(t,r,n){function e(t,r){if(null===t||void 0===t)throw Error(r)}n.d(r,{k:function(){return e}})}}]);