(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{99693:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(67432)}])},67432:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>F});var n=t(14952),a=t(34618),s=t(92831),i=t(65723),u=t(29766),o=t(22155),c=t(53876),l=t(33925),d=t(48747),f=t(83043),p=t(58139);let h=function(e){var r=e.className,t=(0,p._)(e,["className"]);return(0,i.jsx)("select",(0,a._)({className:"block text-gray-700 py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ".concat(r||"")},t))};var m=t(48967),v=t(12551),g=t(61760),y=t(65959),x=t(57277),b=t(59197),w=new Set(["csv","gpx"]),_=function(e){var r=e.onInputRead,n=(0,u.useRouter)(),a=(0,v._)(o.useState(!1),2),s=a[0],c=a[1],l=(0,v._)(o.useState(""),2),f=l[0],p=l[1],h=(0,v._)(o.useState(!1),2),_=h[0],S=h[1],j=(0,v._)(o.useState(void 0),2),N=j[0],T=j[1],k=(0,v._)(o.useState(void 0),2),P=k[0],R=k[1];o.useEffect(function(){!f&&N&&P&&c(!0)},[f,N,P,r]);var C=o.useCallback(function(e){var r,n;r=(0,m._)(function(){return(0,y.YH)(this,function(r){switch(r.label){case 0:var n;return S(!0),[4,Promise.all(Array.from(e).map((n=(0,m._)(function(e){var r,n;return(0,y.YH)(this,function(a){var s,i;switch(a.label){case 0:if(n=null===(r=e.name.match(/\.(.*)$/))||void 0===r?void 0:r[1],!w.has(n))throw Error("invalid filename. must end with ".concat((0,g._)(w).join(", ")));switch(n){case"csv":return[3,1];case"gpx":return[3,3]}return[3,5];case 1:return[4,Promise.resolve().then(t.bind(t,22774)).then((s=(0,m._)(function(r){return(0,y.YH)(this,function(t){switch(t.label){case 0:return[4,r.getAeroqualS5000()];case 1:return[2,t.sent().stream.parse(e.stream().getReader())]}})}),function(e){return s.apply(this,arguments)}))];case 2:return T(a.sent()),[3,6];case 3:return[4,t.e(472).then(t.bind(t,11472)).then((i=(0,m._)(function(r){var t;return(0,y.YH)(this,function(n){switch(n.label){case 0:return t=r.ofGpxString,[4,e.text()];case 1:return[2,t.apply(r,[n.sent()])]}})}),function(e){return i.apply(this,arguments)}))];case 4:return R(a.sent()),[3,6];case 5:throw Error("unhandled case: ".concat(n));case 6:return[2]}})}),function(e){return n.apply(this,arguments)}))).finally(function(){S(!1)})];case 1:return r.sent(),[2]}})}),n=function(e){return p(String(e))},Promise.resolve(r()).catch(n)},[]);return(0,i.jsxs)(i.Fragment,{children:[f?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Error"}),(0,i.jsx)("p",{children:f}),(0,i.jsx)(d.A,{onClick:function(){return p("")},children:"Try again?"})]}):(0,i.jsxs)(i.Fragment,{children:[_?(0,i.jsx)("p",{children:"Loading..."}):null,(0,i.jsx)(x.l,{disabled:_,multiple:!0,handleChange:C,name:"file",types:(0,g._)(w)}),N?(0,i.jsx)("p",{className:"text-green-800",children:"✅ AeroqualS500"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing AeroqualS500 file"}),P?(0,i.jsx)("p",{className:"text-green-800",children:"✅ Strava"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing strava file"})]}),(0,i.jsx)(d.A,{disabled:!s,className:"block m-auto mt-2",onClick:(0,m._)(function(){return(0,y.YH)(this,function(e){if(!P||!N)throw Error("expected Strava & MiniWras data");return r((0,b.combine)({strava:P,aeroqualS500:N})),n.push("/map"),[2]})}),children:"Submit"})]})},S=function(e){return(0,i.jsxs)(h,(0,s._)((0,a._)({},e),{children:[(0,i.jsx)("option",{value:"googlesheetsurl",children:"Google Sheets URL"}),(0,i.jsx)("option",{disabled:!0,value:"googledrive",children:"Google Drive"}),(0,i.jsx)("option",{disabled:!0,value:"csvurl",children:"CSV URL"})]}))},j=t(32793),N=t(22774),T=new Set(["dat","csv","gpx"]),k=function(e){var r=e.onInputRead,n=(0,u.useRouter)(),a=(0,v._)(o.useState(!1),2),s=a[0],c=a[1],l=(0,v._)(o.useState(""),2),f=l[0],p=l[1],h=(0,v._)(o.useState(!1),2),b=h[0],w=h[1],_=(0,v._)(o.useState(void 0),2),S=_[0],k=_[1],P=(0,v._)(o.useState(void 0),2),R=P[0],C=P[1],M=(0,v._)(o.useState(void 0),2),E=M[0],A=M[1];o.useEffect(function(){!f&&R&&E&&c(!0)},[f,S,R,E,r]);var H=o.useCallback(function(e){var r,n;r=(0,m._)(function(){return(0,y.YH)(this,function(r){switch(r.label){case 0:var n;return w(!0),[4,Promise.all(Array.from(e).map((n=(0,m._)(function(e){var r,n,a,s;return(0,y.YH)(this,function(i){switch(i.label){case 0:if(n=null===(r=e.name.match(/\.(.*)$/))||void 0===r?void 0:r[1],!T.has(n))throw Error("invalid filename. must end with ".concat((0,g._)(T).join(", ")));switch(n){case"csv":return[3,1];case"dat":return[3,4];case"gpx":return[3,7]}return[3,10];case 1:return[4,(0,N.getPocket)()];case 2:case 5:return[4,i.sent().stream.parse(e.stream().getReader())];case 3:return k(i.sent().records),[3,11];case 4:return[4,(0,N.getMiniWras)()];case 6:return C(i.sent().records),[3,11];case 7:return[4,t.e(472).then(t.bind(t,11472))];case 8:return a=i.sent(),[4,e.text()];case 9:return s=i.sent(),A(a.ofGpxString(s)),[3,11];case 10:throw Error("unhandled case: ".concat(n));case 11:return[2]}})}),function(e){return n.apply(this,arguments)}))).finally(function(){w(!1)})];case 1:return r.sent(),[2]}})}),n=function(e){return p(String(e))},Promise.resolve(r()).catch(n)},[]);return(0,i.jsxs)(i.Fragment,{children:[f?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Error"}),(0,i.jsx)("p",{children:f}),(0,i.jsx)(d.A,{onClick:function(){return p("")},children:"Try again?"})]}):(0,i.jsxs)(i.Fragment,{children:[b?(0,i.jsx)("p",{children:"Loading..."}):null,(0,i.jsx)(x.l,{disabled:b,multiple:!0,handleChange:H,name:"file",types:(0,g._)(T)}),S?(0,i.jsx)("p",{className:"text-green-800",children:"✅ PocketLabs"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing pocketlab file"}),R?(0,i.jsx)("p",{className:"text-green-800",children:"✅ MiniWras"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing miniwras file"}),E?(0,i.jsx)("p",{className:"text-green-800",children:"✅ Strava"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing strava file"})]}),(0,i.jsx)(d.A,{disabled:!s,className:"block m-auto mt-2",onClick:(0,m._)(function(){return(0,y.YH)(this,function(e){switch(e.label){case 0:return[4,(0,N.getMiniWras)()];case 1:if(e.sent(),!E||!R)throw Error("expected Strava & MiniWras data");return r((0,j.kg)({pocketlabs:S,strava:E,miniwras:R})),n.push("/device/miniwras/calibration"),[2]}})}),children:"Submit"})]})},P=t(85330),R=new Set(["csv","gpx"]),C=function(e){var r=e.onInputRead,n=(0,u.useRouter)(),a=(0,v._)(o.useState(!1),2),s=a[0],c=a[1],l=(0,v._)(o.useState(""),2),f=l[0],p=l[1],h=(0,v._)(o.useState(!1),2),b=h[0],w=h[1],_=(0,v._)(o.useState(void 0),2),S=_[0],j=_[1],T=(0,v._)(o.useState(void 0),2),k=T[0],C=T[1];o.useEffect(function(){!f&&S&&k&&c(!0)},[f,S,k,r]);var M=o.useCallback(function(e){var r,n;r=(0,m._)(function(){return(0,y.YH)(this,function(r){switch(r.label){case 0:var n;return w(!0),[4,Promise.all(Array.from(e).map((n=(0,m._)(function(e){var r,n,a,s;return(0,y.YH)(this,function(i){switch(i.label){case 0:if(n=null===(r=e.name.match(/\.(.*)$/))||void 0===r?void 0:r[1],!R.has(n))throw Error("invalid filename. must end with ".concat((0,g._)(R).join(", ")));switch(n){case"csv":return[3,1];case"gpx":return[3,4]}return[3,7];case 1:return[4,(0,N.getTigerXt)()];case 2:return[4,i.sent().stream.parse(e.stream().getReader())];case 3:return j(i.sent()),[3,8];case 4:return[4,t.e(472).then(t.bind(t,11472))];case 5:return a=i.sent(),[4,e.text()];case 6:return s=i.sent(),C(a.ofGpxString(s)),[3,8];case 7:throw Error("unhandled case: ".concat(n));case 8:return[2]}})}),function(e){return n.apply(this,arguments)}))).finally(function(){w(!1)})];case 1:return r.sent(),[2]}})}),n=function(e){return p(String(e))},Promise.resolve(r()).catch(n)},[]);return(0,i.jsxs)(i.Fragment,{children:[f?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h3",{children:"Error"}),(0,i.jsx)("p",{children:f}),(0,i.jsx)(d.A,{onClick:function(){return p("")},children:"Try again?"})]}):(0,i.jsxs)(i.Fragment,{children:[b?(0,i.jsx)("p",{children:"Loading..."}):null,(0,i.jsx)(x.l,{disabled:b,multiple:!0,handleChange:M,name:"file",types:(0,g._)(R)}),S?(0,i.jsx)("p",{className:"text-green-800",children:"✅ Tiger XT CSV"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing Tiger XT CSV file"}),k?(0,i.jsx)("p",{className:"text-green-800",children:"✅ GPS Track"}):(0,i.jsx)("p",{className:"text-red-800",children:"Missing GPS GPX file"})]}),(0,i.jsx)(d.A,{disabled:!s,className:"block m-auto mt-2",onClick:(0,m._)(function(){return(0,y.YH)(this,function(e){if(!k||!S)throw Error("expected GPS & Tiger XT data");return r((0,P.combine)({tigerXt:S,strava:k})),n.push("/map"),[2]})}),children:"Submit"})]})},M=new Set([l.Dr,l.cf,l.zo]),E=function(e){var r=e.datasource,t=e.isRenderingUrlErrorState,n=e.isSubmitDisabled,a=(e.luggage,e.onDatasourceSourceChange),s=e.onMiniWrasOrAeroqualReady,u=e.onSubmit,o=e.onUrlsChange,c=e.onSensorTypeChange,p=e.sensorType,m=e.urls,v=!M.has(p);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"text-center text-gray-600 gray-200",children:"Enter your datasource"}),(0,i.jsxs)(h,{defaultValue:p,placeholder:"Select sensor type",className:"w-full mt-1",onMouseOver:function(){p===l.xL&&c(-1)},onMouseOut:function(){p<l.xL&&c(0)},onChange:function(e){var r=e.currentTarget.value;o([]),c(parseInt(r,10))},children:[(0,i.jsx)("option",{disabled:!0,value:l.xL,children:"Select sensor type..."}),(0,i.jsx)("option",{value:l.tH,children:"Flow"}),(0,i.jsx)("option",{value:l.Ke,children:"PocketLabs"}),(0,i.jsx)("option",{value:l.Dr,children:"MiniWRAS"}),(0,i.jsx)("option",{value:l.cZ,children:"airmap™ GPS"}),(0,i.jsx)("option",{value:l.cf,children:"Aeroqual S500"}),(0,i.jsx)("option",{value:l.zo,children:"Tiger XT"})]}),v?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S,{required:!0,className:"w-full mt-1",value:r,onChange:a}),(0,i.jsx)(f.A,{required:!0,error:t,className:"w-full mt-1",placeholder:p===l.tH?"User Measures: https://url/to/data":"https://url/to/data",defaultValue:m[0],onChange:function(e){return o([e.currentTarget.value,m[1]].filter(Boolean))}},"".concat(p,"-url-1"))]}):null,p===l.tH?(0,i.jsx)(f.A,{required:!0,error:t,className:"w-full mt-1",placeholder:"User Positions: https://url/to/data",defaultValue:m[1],onChange:function(e){return o([m[0],e.currentTarget.value])}},"".concat(p,"-url-2")):null,t?(0,i.jsxs)("p",{className:"text-sm text-left text-red-600",children:["Sheets URL must have the form:",(0,i.jsx)("br",{}),"https://docs.google.com/spreadsheets/d/:id/gviz/tq"]}):null,p===l.Dr?(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(k,{onInputRead:function(e){s(e)}})}):null,p===l.cf?(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(_,{onInputRead:function(e){s(e)}})}):null,p===l.zo?(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(C,{onInputRead:function(e){s(e)}})}):null,v?(0,i.jsx)(d.A,{disabled:n,className:"block m-auto mt-2",onClick:u,children:"Submit"}):null]})},A=t(521),H=t(95988),D=[];function F(){var e=(0,A.xw)(),r=e.value,t=e.update,o=r.urls,d=r.datasource,f=r.sensorType,p=r.luggage,h=function(e,i){return t((0,s._)((0,a._)({},r),(0,n._)({},e,i)))},m=(0,H.m_)(),v=m.value.accessToken;m.update;var g=o.every(function(e){return(0,c.zB)(e)})&&(f!==l.tH||2===o.length),y=(0,u.useRouter)(),x=!!(o.length&&!g),b=!g||!v||0===f||f===l.Dr&&!p||f===l.zo&&!p;return(0,i.jsxs)("form",{className:"max-w-screen-md content home w-96",onSubmit:function(e){return e.preventDefault()},children:[(0,i.jsx)("h1",{className:"text-4xl text-center",children:"airmap!"}),(0,i.jsx)(E,{isSubmitDisabled:b,luggage:p,datasource:d,sensorType:f,isRenderingUrlErrorState:x,onDatasourceSourceChange:function(e){return h("datasource",e.currentTarget.value)},onSensorTypeChange:function(e){return t(function(t){return{datasource:t.datasource,luggage:D.includes(r.sensorType)?t.luggage:null,urls:[],sensorType:e}})},onUrlsChange:function(e){return h("urls",e)},onMiniWrasOrAeroqualReady:function(e){return h("luggage",e)},urls:o,onSubmit:function(){b||(h("urls",o.map(function(e){return(0,c.DM)(e)})),y.push("/map"))}}),null]})}},48747:(e,r,t)=>{"use strict";t.d(r,{A:()=>o});var n=t(34618),a=t(58139),s=t(65723),i=t(70851);t(22155);var u={bg:"bg-gray-600 hover:bg-gray-700 focus:ring-gray-500 focus:ring-offset-gray-200",display:"flex"};let o=function(e){var r=e.styles,t=void 0===r?{}:r,o=t.bg,c=void 0===o?u.bg:o,l=t.display,d=void 0===l?u.display:l,f=e.type,p=e.className,h=(0,a._)(e,["styles","type","className"]),m=(0,i.A)(p,c,d,"py-2 px-4 justify-center items-center text-white transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg",h.disabled?"bg-gray-400 hover:bg-gray-400 cursor-not-allowed":"");return(0,s.jsx)("button",(0,n._)({type:void 0===f?"button":f,className:m},h))}},83043:(e,r,t)=>{"use strict";t.d(r,{A:()=>u});var n=t(34618),a=t(58139),s=t(65723),i=t(70851);t(22155);let u=function(e){var r=e.error,t=e.className,u=(0,a._)(e,["error","className"]);return(0,s.jsx)("input",(0,n._)({className:(0,i.A)("rounded-lg border-transparent flex-1 appearance-none border border-gray-400 py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm text-base focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent",r?"border-red-600":void 0,t)},u))}},22774:(e,r,t)=>{"use strict";t.r(r),t.d(r,{getAeroqualS5000:()=>d,getAirmapGps:()=>l,getFlow:()=>o,getMiniWras:()=>c,getPocket:()=>u,getTigerXt:()=>f,useSensorMappingResources:()=>p});var n=t(48967),a=t(65959),s=t(29928),i=t(33925),u=function(){return t.e(994).then(t.bind(t,26994)).then(function(e){return e.getResources()})},o=function(){var e;return t.e(881).then(t.bind(t,66881)).then((e=(0,n._)(function(e){return(0,a.YH)(this,function(r){return[2,e.getResources()]})}),function(r){return e.apply(this,arguments)}))},c=function(){var e;return t.e(867).then(t.bind(t,67867)).then((e=(0,n._)(function(e){return(0,a.YH)(this,function(r){return[2,e.getResources()]})}),function(r){return e.apply(this,arguments)}))},l=function(){var e;return t.e(109).then(t.bind(t,38109)).then((e=(0,n._)(function(e){return(0,a.YH)(this,function(r){return[2,e.getResources()]})}),function(r){return e.apply(this,arguments)}))},d=function(){var e;return t.e(12).then(t.bind(t,11012)).then((e=(0,n._)(function(e){return(0,a.YH)(this,function(r){return[2,e.getResources()]})}),function(r){return e.apply(this,arguments)}))},f=function(){var e;return t.e(571).then(t.bind(t,57571)).then((e=(0,n._)(function(e){return(0,a.YH)(this,function(r){return[2,e.getResources()]})}),function(r){return e.apply(this,arguments)}))},p=function(e){return(0,s.useQuery)({queryKey:"get-mapping-".concat(e),queryFn:(0,n._)(function(){return(0,a.YH)(this,function(r){switch(r.label){case 0:return[4,e===i.Ke?u():e===i.tH?o():e===i.Dr?c():e===i.cZ?l():e===i.cf?d():e===i.zo?f():function(){throw Error("unsupported sensor type ".concat(e))}()];case 1:return[2,r.sent()]}})}),cacheTime:1e9})}},53876:(e,r,t)=>{"use strict";t.d(r,{DM:()=>u,k8:()=>o,zB:()=>i});var n=t(12551),a=t(61760),s=t(944);function i(e){try{var r=new URL(e),t=(0,n._)(r.pathname.substr(1).split("/"),3),a=t[0],s=t[1],i=t[2];if("spreadsheets"===a&&"d"===s&&i&&r.host.match("google.com"))return!0}catch(e){}return!1}function u(e){var r=new URL(e);return r.pathname=(0,a._)(r.pathname.substr(1).split("/").splice(0,3)).concat(["export"]).join("/"),String(r)}var o=function(e){var r=new URL(e),t=new URLSearchParams(r.search);return t.has("format")||t.set("format","csv"),r.search=t.toString(),(0,s.f)(u(r.toString()),{mode:"cors",redirect:"follow",headers:{accept:"text"}})}},59197:(e,r,t)=>{"use strict";t.r(r),t.d(r,{combine:()=>f,dateField:()=>p,download:()=>c,downloadGeoJSON:()=>d,toGeoJSON:()=>l});var n=t(48967),a=t(34618),s=t(12551),i=t(65959),u=t(53876),o=t(85749),c=function(){var e=(0,n._)(function(e){return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all([(0,u.k8)(e[0]).then(o.parse)])];case 1:return[2,s._.apply(void 0,[r.sent(),1])[0]]}})});return function(r){return e.apply(this,arguments)}}(),l=function(e){return{type:"FeatureCollection",features:e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:e}})}},d=function(e){throw Error("!unimplemented")},f=function(e){var r=e.aeroqualS500,t=e.strava,n=[],s=!0,i=!1,u=void 0;try{for(var o,c=r[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var d=o.value,f=d.date,p=function(e){for(;;){var r=t[0],n=null==r?void 0:r.date;if(!n||!r)return console.warn("no strava data, skipping, dropping src point"),null;if(n<e)t.shift();else if(n.getTime()-e.getTime()<6e4)return t.shift(),r;else return console.warn("src > 1 minute away from strava points, dropping src point"),null}}(f);p&&n.push((0,a._)({latitude:p.lat,longitude:p.lon},p,d))}}catch(e){i=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(i)throw u}}return l(n)},p="date"},85749:(e,r,t)=>{"use strict";t.r(r),t.d(r,{parse:()=>o});var n=t(38362),a=t(48967),s=t(12551),i=t(65959),u=t(944),o=function(){var e=(0,a._)(function(e){var r,t,a,o,c,l,d,f,p,h,m,v,g,y;return(0,i.YH)(this,function(i){switch(i.label){case 0:r=[],t=void 0,a=!1,o=!1,i.label=1;case 1:i.trys.push([1,6,7,12]),l=(0,n._)((0,u.S)(e)),i.label=2;case 2:return[4,l.next()];case 3:if(!(a=!(d=i.sent()).done))return[3,5];if(f=d.value.split(","),!t)return t=f,[3,4];h=(p=(0,s._)(f,2))[0],m=p[1],v=new Date(h),g=Number(m),r.push({date:v,tvoc:g}),i.label=4;case 4:return a=!1,[3,2];case 5:return[3,12];case 6:return y=i.sent(),o=!0,c=y,[3,12];case 7:if(i.trys.push([7,,10,11]),!(a&&null!=l.return))return[3,9];return[4,l.return()];case 8:i.sent(),i.label=9;case 9:return[3,11];case 10:if(o)throw c;return[7];case 11:return[7];case 12:return[2,r]}})});return function(r){return e.apply(this,arguments)}}()},32793:(e,r,t)=>{"use strict";t.d(r,{bl:()=>i.RHO_GRIMM,kg:()=>s,cz:()=>i.sum,Tc:()=>i["toPartialμgPerM3"],dT:()=>i["toPartialμgPerM3SansRho"]});var n=t(34618),a=t(92831),s=function(e){var r=e.pocketlabs,t=void 0===r?[]:r,s=e.strava,i=e.miniwras,u=[],o=!0,c=!1,l=void 0;try{for(var d,f=i[Symbol.iterator]();!(o=(d=f.next()).done);o=!0){var p=d.value,h=p.date,m=function(e){for(;;){var r=s[0],t=null==r?void 0:r.date;if(!t||!r)return console.warn("no strava data, skipping, dropping miniwras point"),null;if(t<e)s.shift();else if(t.getTime()-e.getTime()<6e4)return s.shift(),r;else return console.warn("miniwras > 1 minute away from strava points, dropping miniwras point"),null}}(h),v=function(e){for(;;){var r=t[0],n=null==r?void 0:r.date;if(!n||!r)return null;if(n<e)t.shift();else if(n.getTime()-e.getTime()<6e4)return t.shift(),r;else return null}}(h);m&&u.push((0,a._)((0,n._)({latitude:m.lat,longitude:m.lon},m,p),{pm05Calibrated:-1,pm05Derived:-1,pm05To3Calibrated:-1,pm01To03Derived:-1,pocketlabsEntry:v||void 0}))}}catch(e){c=!0,l=e}finally{try{o||null==f.return||f.return()}finally{if(c)throw l}}return{type:"FeatureCollection",features:u.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:e}})}},i=t(58875)},58875:(e,r,t)=>{"use strict";t.r(r),t.d(r,{RHO_GRIMM:()=>u,parse:()=>m,sum:()=>c,toPartialμgPerM3:()=>f,toPartialμgPerM3SansRho:()=>p});var n=t(48967),a=t(65959),s=t(69152),i=t(12551),u=1800,o=[6.842765,7.1751666,7.0114602,6.9088991,7.0263146,6.9180838,7.0393966,6.989318,6.9812267,5.2701795,14.0655402,13.8262107,14.1929174,14.0017841,13.8883794,13.9963284,14.0409634,14.2779903,13.8513492,13.898864,13.6873067,14.3390373,13.8184393,14.1478588,14.0655395,13.8262102,14.1929179,13.8296286,14.062005,13.9963317,14.040958,14.001345,13.96783,14,13.95533,14.00924,14,14,14,14,14],c=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.reduce(function(e,r){return e+r},0)},l=function(e){return e/1e9},d=function(e){return 1e6*e},f=function(e,r,t,n){return d(e)/o[t]*(Math.PI/6)*Math.pow(l(r),3)*n*(1e9/1)},p=function(e,r,t){return d(e)/o[t]*(Math.PI/6)*Math.pow(l(r),3)*(1e9/1)},h={date:function(e){return new Date(e.trim().split(" ").map(function(e,r){if(0===r){var t=(0,i._)(e.split("/"),3),n=t[0],a=t[1],s=t[2],u=function(e){return 1===e.length?"0".concat(e):e};return"".concat(n,"-").concat(u(a),"-").concat(u(s))}return"T".concat(e,".000+01:00")}).join(""))},pm_2_5:function(e){var r=parseFloat(e);return Number.isNaN(r)?(console.error("Expected a number, got a NaN. MiniWras export problem?"),0):r}},m=function(){var e=(0,n._)(function(e){var r,t,n,i,o,c,l=arguments;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:{records:[],partial:"",particleDiametersAscending:[]},[4,e.read()];case 1:return n=(t=a.sent()).done,((i=t.value)||n)&&(r.partial+="string"==typeof i?i:i?new TextDecoder().decode(i):"",c=(o=r.partial.split(/\n/g).map(function(e){return e.trim()}).filter(function(e){return!!e})).length-1,o.forEach(function(e,t){if(c!==t||n){var a=e.includes(",")?e.split(","):e.split("	");if(r.headerIndiciesByName){var i=a[r.headerIndiciesByName.Time],o=a[r.headerIndiciesByName["pm2.5 [ug/m3]"]];(0,s.V)(i,"date missing"),(0,s.V)(Number.isFinite(o),"column 'pm2.5 [ug/m3]' missing");for(var l=0,d=r.headerIndiciesByName["10.00 nm"],p=r.headerIndiciesByName["449.48 nm"],m=r.headerIndiciesByName["3238.77 nm"],v=[],g=0,y={all:[],sub500nm:[],sub3000nm:[]};d<m;){var x=parseFloat(a[d]),b=(r.particleDiametersAscending[g]+r.particleDiametersAscending[g+1])/2,w={value:x,diameterMidpointNm:b,calibrationIndex:g};y.all.push(w);var _=f(x,b,g,u);d<p&&(y.sub500nm.push(w),l+=_),d<m&&y.sub3000nm.push(w),++d,++g}console.log({sampleNum:r.records.length,pm05:l,debug:v}),r.records.push({channels:y,date:h.date(i),debug:v,pm05EndCol:p,pm05Naive:l,pm_2_5:h.pm_2_5(o)}),n&&(r.partial="")}else r.headerCells=a,r.headerIndiciesByName=a.reduce(function(e,t,n){var a=t.trim();e[a]=n;var s=a.match(/\s*(\d+\.\d+)\s+nm/);return s&&r.particleDiametersAscending.push(parseInt(s[1],10)),e},{})}else r.partial=e})),[2,n?r:m(e,r)]}})});return function(r){return e.apply(this,arguments)}}()},85330:(e,r,t)=>{"use strict";t.r(r),t.d(r,{combine:()=>f,dateField:()=>p,download:()=>c,downloadGeoJSON:()=>d,toGeoJSON:()=>l});var n=t(48967),a=t(34618),s=t(12551),i=t(65959),u=t(53876),o=t(39526),c=function(){var e=(0,n._)(function(e){return(0,i.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all([(0,u.k8)(e[0]).then(o.parse)])];case 1:return[2,s._.apply(void 0,[r.sent(),1])[0]]}})});return function(r){return e.apply(this,arguments)}}(),l=function(e){return{type:"FeatureCollection",features:e.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:e}})}},d=function(e){throw Error("!unimplemented")},f=function(e){var r=e.tigerXt,t=e.strava,n=[],s=!0,i=!1,u=void 0;try{for(var o,c=r[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var d=o.value,f=d.date,p=function(e){for(;;){var r=t[0],n=null==r?void 0:r.date;if(!n||!r)return console.warn("no strava data, skipping, dropping src point"),null;if(n<e)t.shift();else if(n.getTime()-e.getTime()<6e4)return t.shift(),r;else return console.warn("src > 1 minute away from strava points, dropping src point"),null}}(f);p&&n.push((0,a._)({latitude:p.lat,longitude:p.lon},p,d))}}catch(e){i=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(i)throw u}}return l(n)},p="date"},39526:(e,r,t)=>{"use strict";t.r(r),t.d(r,{parse:()=>o});var n=t(38362),a=t(48967),s=t(12551),i=t(65959),u=t(944),o=function(){var e=(0,a._)(function(e){var r,t,a,o,c,l,d,f,p,h,m,v,g,y,x,b;return(0,i.YH)(this,function(i){switch(i.label){case 0:r=[],t=!1,a=!1,o=!1,i.label=1;case 1:i.trys.push([1,6,7,12]),l=(0,n._)((0,u.S)(e)),i.label=2;case 2:return[4,l.next()];case 3:if(!(a=!(d=i.sent()).done))return[3,5];if(f=d.value,!t&&f.includes("Date")&&f.includes("Time"))return f.split(","),t=!0,[3,4];if(!t)return[3,4];!((p=f.split(",")).length>=3)||(m=(h=(0,s._)(p,3))[0],v=h[1],g=h[2],y=new Date("".concat(m," ").concat(v," UTC")),x=Number(g),isNaN(y.getTime())||isNaN(x)||r.push({date:y,isobutylene:x})),i.label=4;case 4:return a=!1,[3,2];case 5:return[3,12];case 6:return b=i.sent(),o=!0,c=b,[3,12];case 7:if(i.trys.push([7,,10,11]),!(a&&null!=l.return))return[3,9];return[4,l.return()];case 8:i.sent(),i.label=9;case 9:return[3,11];case 10:if(o)throw c;return[7];case 11:return[7];case 12:return[2,r]}})});return function(r){return e.apply(this,arguments)}}()},944:(e,r,t)=>{"use strict";function n(e){this.wrapped=e}function a(e){var r,t;function a(r,t){try{var i=e[r](t),u=i.value,o=u instanceof n;Promise.resolve(o?u.wrapped:u).then(function(e){if(o){a("next",e);return}s(i.done?"return":"normal",e)},function(e){a("throw",e)})}catch(e){s("throw",e)}}function s(e,n){switch(e){case"return":r.resolve({value:n,done:!0});break;case"throw":r.reject(n);break;default:r.resolve({value:n,done:!1})}(r=r.next)?a(r.key,r.arg):t=null}this._invoke=function(e,n){return new Promise(function(s,i){var u={key:e,arg:n,resolve:s,reject:i,next:null};t?t=t.next=u:(r=t=u,a(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}t.d(r,{f:()=>u,S:()=>o}),"function"==typeof Symbol&&Symbol.asyncIterator&&(a.prototype[Symbol.asyncIterator]=function(){return this}),a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)};var s=t(65959),i=t(69152),u=function(e,r){return fetch(e,r).then(function(e){return e.body}).then(function(e){var r=null==e?void 0:e.getReader();return(0,i.V)(r,"missing stream body"),r})};function o(e){return c.apply(this,arguments)}function c(){var e;return e=function(e){var r,t,a,i,u,o,c,l,d,f,p,h,m;return(0,s.YH)(this,function(s){switch(s.label){case 0:r=new TextDecoder,t="",s.label=1;case 1:return[4,new n(e.read())];case 2:if(i=(a=s.sent()).done,u=a.value,!i)return[3,5];if(!t)return[3,4];return[4,t];case 3:s.sent(),s.label=4;case 4:return[3,14];case 5:t+=r.decode(u,{stream:!0}),t=null!==(c=(o=t.split("\n")).pop())&&void 0!==c?c:"",l=!0,d=!1,f=void 0,s.label=6;case 6:s.trys.push([6,11,12,13]),p=o[Symbol.iterator](),s.label=7;case 7:if(l=(h=p.next()).done)return[3,10];return[4,h.value];case 8:s.sent(),s.label=9;case 9:return l=!0,[3,7];case 10:return[3,13];case 11:return m=s.sent(),d=!0,f=m,[3,13];case 12:try{l||null==p.return||p.return()}finally{if(d)throw f}return[7];case 13:return[3,1];case 14:return[2]}})},(c=function(){return new a(e.apply(this,arguments))}).apply(this,arguments)}},69152:(e,r,t)=>{"use strict";function n(e,r){if(null==e)throw Error(r)}t.d(r,{V:()=>n})},38362:(e,r,t)=>{"use strict";function n(e){var r,t,n,s=2;for("undefined"!=typeof Symbol&&(t=Symbol.asyncIterator,n=Symbol.iterator);s--;){if(t&&null!=(r=e[t]))return r.call(e);if(n&&null!=(r=e[n]))return new a(r.call(e));t="@@asyncIterator",n="@@iterator"}throw TypeError("Object is not async iterable")}function a(e){function r(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var r=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:r}})}return(a=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(e){var t=this.s.return;return void 0===t?Promise.resolve({value:e,done:!0}):r(t.apply(this.s,arguments))},throw:function(e){var t=this.s.return;return void 0===t?Promise.reject(e):r(t.apply(this.s,arguments))}},new a(e)}t.d(r,{_:()=>n})}},e=>{var r=r=>e(e.s=r);e.O(0,[277,636,593,792],()=>r(99693)),_N_E=e.O()}]);