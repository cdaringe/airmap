(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3988:function(e,r,t){"use strict";t.d(r,{Z:function(){return c}});var n=t(9899);var o=t(641);function c(e){return function(e){if(Array.isArray(e))return(0,n.Z)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||(0,o.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},4585:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return T}});var n=t(4637),o=t(1384),c=t(9496),i=t(7592);function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var u,s=function(e){var r=e.className,t=(0,i.Z)(e,["className"]);return(0,n.jsx)("select",function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({className:"block text-gray-700 py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ".concat(r||"")},t))};function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}!function(e){e.googlesheetsurl="googlesheetsurl",e.csvurl="csvurl",e.googleDrive="googledrive"}(u||(u={}));var p=function(e){return(0,n.jsxs)(s,f(f({},e),{},{children:[(0,n.jsx)("option",{value:u.googleDrive,children:"Google Drive"}),(0,n.jsx)("option",{value:u.googlesheetsurl,children:"Google Sheets URL"}),(0,n.jsx)("option",{value:u.csvurl,children:"CSV URL"})]}))},d=t(1626);function b(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var g=function(e){var r=e.error,t=e.className,c=(0,i.Z)(e,["error","className"]);return(0,n.jsx)("input",function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?b(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({className:(0,d.Z)("rounded-lg border-transparent flex-1 appearance-none border border-gray-300 py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm text-base focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent",r?"border-red-600":void 0,t)},c))};function O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}var y="bg-gray-600 hover:bg-gray-700",v=function(e){var r=e.bg,t=void 0===r?y:r,c=e.type,a=void 0===c?"button":c,u=e.className,s=(0,i.Z)(e,["bg","type","className"]),l=(0,d.Z)(u,t,"py-2 px-4 flex justify-center items-center focus:ring-gray-500 focus:ring-offset-gray-200 text-white transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg");return(0,n.jsx)("button",function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({type:a,className:l},s))},m=t(3988),h=t(2468),j="https://apis.google.com/js/api.js",w=[],P="init",S=null;var D=function(){var e=function(){var e=(0,c.useState)({loaded:!1,error:!1}),r=e[0],t=e[1];return(0,c.useEffect)((function(){if("loaded"!==P){if("error"!==P){var e=function(e){e&&console.log("error loading the script"),w.forEach((function(e){return e()})),e&&null!==S?(S.remove(),P="error"):P="loaded",S=null};return null===S&&((S=document.createElement("script")).src=j,S.async=!0,document.body.appendChild(S),S.addEventListener("load",(function(){return e(!1)})),S.addEventListener("error",(function(){return e(!0)})),P="loading"),w.push((function(e){t({loaded:!0,error:e})})),function(){S&&(S.removeEventListener("load",e),S.removeEventListener("error",e))}}t({loaded:!0,error:!0})}else t({loaded:!0,error:!1})}),[j]),[r.loaded,r.error]}(),r=(0,h.Z)(e,2),t=r[0],n=r[1],o=(0,c.useState)(!1),i=o[0],a=o[1],u=(0,c.useState)(null),s=u[0],l=u[1];return(0,c.useEffect)((function(){i||!n&&t&&Promise.all([new Promise((function(e){return window.gapi.load("auth",e)})),new Promise((function(e){return window.gapi.load("picker",{callback:e})}))]).then((function(){return a(!0)}),l)}),[t,n,i]),{isPickerApiLoaded:i,error:n||s}};function E(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function k(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?E(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var x=["https://www.googleapis.com/auth/drive.readonly"];function N(e){var r=e.onSelect,t=e.onPreBuild,n=(0,i.Z)(e,["onSelect","onPreBuild"]),o=D(),a=o.isPickerApiLoaded,u=o.error,s=(0,c.useState)(n),l=s[0],f=s[1],p=(0,c.useState)(!1),d=p[0],b=p[1],g=(0,c.useState)(!1),O=g[0],y=g[1],v=(0,c.useCallback)((function(){if(!a)throw new Error("picker is not yet loaded");var e=function(e){var r=e.token,t=e.developerKey,n=e.viewId,o=e.disableDefaultView,c=void 0!==o&&o;if(!r)throw new Error("missing token");var i=new google.picker.DocsView(n||google.picker.ViewId.DOCS),a=(new google.picker.PickerBuilder).setOAuthToken(r).setDeveloperKey(t);return c||a.addView(i),{builder:a,view:i}}(l);t&&t(e),e.builder.setCallback((function(e){e.action===google.picker.Action.PICKED&&r(e)})).build().setVisible(!0)}),[l,r,a]);(0,c.useEffect)((function(){d&&(v(),b(!1))}),[d,v]);return(0,c.useEffect)((function(){O&&window.gapi.auth.authorize({client_id:l.clientId,scope:l.customScopes?[].concat(x,(0,m.Z)(l.customScopes)):x,immediate:!1},(function(e){y(!1),e&&!e.error&&(f((function(r){return k(k({},r),{},{token:e.access_token})})),b(!0))}))}),[O,l.clientId,l.customScopes]),{open:function(){if(!l.token)return y(!0);v()},isLoaded:a,error:u}}var L=function(e){var r=e.datasource,t=e.isRenderingUrlErrorState,o=e.isSubmitDisabled,i=e.onDatasourceSourceChange,a=e.onSubmit,s=e.onUrlChange,l=e.url,f=(0,c.useState)(!1),d=f[0],b=f[1],O=N({clientId:"961166063373-si47f62e9dbvbl0ahb4lrpouqf52la6j.apps.googleusercontent.com",developerKey:"AIzaSyAgSzVhl0agLUrEbFow82k9csWtnARfaLY",onPreBuild:function(e){var r=e.builder;e.view.setParent("1RwxRnjTDHfYKMJA_e093jOt8OnMX4D9J").setIncludeFolders(!0).setSelectFolderEnabled(!1).setMode(google.picker.DocsViewMode.LIST),r.enableFeature(google.picker.Feature.MULTISELECT_ENABLED),r.enableFeature(google.picker.Feature.SUPPORT_DRIVES)},onSelect:function(e){var r,t=null===(r=e.docs[0])||void 0===r?void 0:r.url,n=null===t||void 0===t?void 0:t.replace(/\/edit?.*/,"");n&&s(n),b(!0)}}),y=O.open,m=O.isLoaded,h=O.error;(0,c.useEffect)((function(){d&&a()}),[d,a]);var j=r===u.googleDrive;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"gray-200 text-gray-600 text-center",children:"Enter your datasource"}),(0,n.jsx)(p,{className:"w-full mt-1",value:r,onChange:i}),j?(0,n.jsx)(v,{className:"block m-auto mt-2 w-full",onClick:y,disabled:!m||!!h,children:"Click to select from Google Drive"}):(0,n.jsx)(g,{error:t,className:"w-full mt-1 w-full",placeholder:"https://url/to/data",defaultValue:l,onChange:function(e){return s(e.currentTarget.value)}}),t?(0,n.jsxs)("p",{className:"text-red-600 text-left text-sm",children:["Sheets URL must have the form:",(0,n.jsx)("br",{}),"https://docs.google.com/spreadsheets/d/:id/gviz/tq"]}):null,j?null:(0,n.jsx)(v,{disabled:o,className:"block m-auto mt-2",bg:o?"bg-gray-300":void 0,onClick:a,children:"Submit"})]})};function Z(e){try{var r=new URL(e),t=r.pathname.substr(1).split("/"),n=(0,h.Z)(t,3),o=n[0],c=n[1],i=n[2];if("spreadsheets"===o&&"d"===c&&i&&r.host.match("google.com"))return!0}catch(a){}return!1}function C(e){if(!Z(e))throw new Error("url incompatible ".concat(e));var r=new URL(e);return r.pathname=[].concat((0,m.Z)(r.pathname.substr(1).split("/").splice(0,3)),["gviz","tq"]).join("/"),String(r)}var _=t(419),R=t(4942),U=t(8047);function I(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function A(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?I(Object(t),!0).forEach((function(r){(0,o.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function T(){var e=(0,_.wl)(),r=e.value,t=r.url,o=r.datasource,c=e.update,i=(0,U.jU)(),a=i.value.accessToken,u=(i.update,function(e){var r;try{r=new URL(e)}catch(t){return!1}return"http:"===r.protocol||"https:"===r.protocol}(t)&&t.match("gviz/tq")),s=u||Z(t),l=(0,R.useRouter)(),f=!(!t||s),p=!s||!a;return(0,n.jsxs)("form",{className:"content home w-96 max-w-screen-md",onSubmit:function(e){return e.preventDefault()},children:[(0,n.jsx)("h1",{className:"text-4xl text-center",children:"airmap!"}),(0,n.jsx)(L,A({},{isSubmitDisabled:p,datasource:o,onDatasourceSourceChange:function(e){c({url:t,datasource:e.currentTarget.value})},isRenderingUrlErrorState:f,onUrlChange:function(e){c({url:e,datasource:o})},url:t,onSubmit:function(){if(!p){var e=Z(t);!u&&e&&c({datasource:o,url:C(t)}),l.push("/map")}}}))]})}},3583:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(4585)}])}},function(e){e.O(0,[888,179],(function(){return r=3583,e(e.s=r);var r}));var r=e.O();_N_E=r}]);