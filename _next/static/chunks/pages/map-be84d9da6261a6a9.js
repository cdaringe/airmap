(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{4306:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return t(1256)}])},1256:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return S}});var r=t(7383),o=t.n(r),i=t(4637),a=t(310),c=t(9496),u=t(8229),l=t(9227),s=t(6869),d=t(5256);function f(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(u){o=!0,i=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var h={visibility:"visible"},y=function(e){var n,t=e.geojson,r=e.onSelectFeature,o=e.circleCases,a=void 0===o?[]:o,l=c.useCallback((function(e){e.preventDefault();var n=f(e.target.queryRenderedFeatures(e.point),1)[0];"Point"===(null===n||void 0===n?void 0:n.geometry.type)?r(n):console.error("no feature found under pointer :thinking:",n)}),[r]),s=c.useCallback((function(e){e.target.getCanvas().style.cursor="pointer"}),[]),d=c.useCallback((function(e){e.target.getCanvas().style.cursor=""}),[]);return(0,i.jsx)(u.Wy,{data:t,circleLayout:h,circlePaint:(n=a,{"circle-color":["case"].concat(p(n),["black"]),"circle-radius":5}),circleOnClick:l,circleOnMouseEnter:s,circleOnMouseLeave:d})},v=t(1825),m=t(6970),b=t(8658),g=t(3793);function x(e,n,t,r,o,i,a){try{var c=e[i](a),u=c.value}catch(l){return void t(l)}c.done?n(u):Promise.resolve(u).then(r,o)}function w(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(u){o=!0,i=u}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function j(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var k=(0,s.default)((function(){return t.e(957).then(t.bind(t,4954))}),{loadableGenerated:{webpack:function(){return[4954]},modules:["../src/components/pages/map.tsx -> ../MeasurementPopup"]}}),C=function(e,n){return{url:"api.mapbox.com"===e.slice(8,22)||"tiles.mapbox.com"===e.slice(10,26)?e.replace("?","?pluginName=sheetMapper&"):e}};function S(){var e;!function(){var e=(0,l.wl)().value.urls,n=(0,m.useRouter)();(0,c.useEffect)((function(){return(!e.length||e.some((function(e){return!e}))?n.push("/"):void 0)&&void 0}),[e,n])}();var n,r=w(c.useState(),2),s=r[0],f=r[1],p=w(c.useState([-122.66155,45.54846]),2),h=p[0],S=p[1],A=(0,l.wl)(),N=A.value,E=N.urls,O=N.sensorType,_=(0,b.rk)(O),T=_.isLoading,F=_.error,I=_.data,P=(void 0===I?{}:I).download,R=(0,g.useQuery)({queryKey:j(E).concat(["undefined"===typeof P?"undefined":(n=P,n&&"undefined"!==typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)]),queryFn:function(){if(P)return P(E)}}),L=R.isLoading,M=R.error,q=R.data,J=void 0===q?{}:q,X=J.geojson,Z=J.circleCases,D=F||M,G=T||L;!function(e,n){(0,c.useEffect)((function(){if(e){var t=(0,v.VWR)(e);t[0]<=-1/0||t[0]>=1/0?console.error("infitity detected. bounds skipped"):n(t)}}),[e])}(X,f);var Y,W=c.useRef((0,u.ZP)({accessToken:"pk.eyJ1IjoicGR4Y2xlYW5haXIiLCJhIjoiY2tweDFuZmxpMjFmbzJ3bXVkajd4dDQ4dSJ9.LYiRB4TgOAckcqZGi-cUXg",transformRequest:C})).current,B=w(c.useState(null),2),Q=B[0],V=B[1],z=c.useCallback((function(){return Q&&V(null)}),[Q,V]);return D?(0,i.jsxs)("div",{className:"p-2",children:[(0,i.jsx)("h1",{children:"Error"}),(0,i.jsx)("h2",{children:"Failed to load map data."}),(0,i.jsx)("p",{children:"string"===typeof D?D:(0,i.jsx)("pre",{children:JSON.stringify(D,null,2)})}),(0,i.jsxs)("p",{children:["Are you sure your datasource is correct?",(0,i.jsx)("pre",{children:JSON.stringify(A,null,2)})]})]}):G?(0,i.jsx)("div",{className:"flex flex-column w-full content justify-center",children:(0,i.jsx)(d.Z,{className:"animate-spin w-20"})}):(null===(e=null===X||void 0===X?void 0:X.features[0])||void 0===e?void 0:e.properties)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.default,{children:(0,i.jsx)("link",{href:"https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css",rel:"stylesheet"})}),0===(null===X||void 0===X?void 0:X.features.length)?(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("h1",{className:"text-xl",children:"Missing data"}),(0,i.jsx)("p",{children:"The data has been downloaded, but is empty :/"})]}):(0,i.jsxs)(W,{onStyleLoad:(Y=o().mark((function e(n){var r,i,a,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.e(255).then(t.bind(t,7255));case 2:r=e.sent,i=r.RulerControl,a=r.ZoomControl,r.InspectControl,c=r.StylesControl,n.addControl(new c,"bottom-right"),n.addControl(new a,"bottom-right"),n.addControl(new i,"bottom-right");case 11:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(t,r){var o=Y.apply(e,n);function i(e){x(o,t,r,i,a,"next",e)}function a(e){x(o,t,r,i,a,"throw",e)}i(void 0)}))}),className:"content w-full",fitBounds:s,center:h,style:"mapbox://styles/pdxcleanair/ckpx7yno443sa17p6iy65qn95",containerStyle:{height:"100%",width:"100vw"},onClick:z,children:[X&&(0,i.jsx)(y,{geojson:X,circleCases:Z,onSelectFeature:function(e){s&&f(void 0),h&&S(e.geometry.coordinates),V(e)}}),Q?(0,i.jsx)(k,{title:"Measurements",className:"h-96 overflow-auto",feature:Q,onClick:function(e){e.preventDefault()}}):void 0]})]}):(0,i.jsx)("p",{className:"p-2",children:"The datafile provided could not be converted into geojson format. Generally, this occurs because the columns in the data sheet do not match the expected field names."})}}},function(e){e.O(0,[774,275,259,214,888,179],(function(){return n=4306,e(e.s=n);var n}));var n=e.O();_N_E=n}]);