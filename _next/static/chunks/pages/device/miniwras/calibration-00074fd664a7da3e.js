(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{48313:(e,r,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/device/miniwras/calibration",function(){return t(54083)}])},54083:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var n=t(12551),a=t(61760),i=t(65723),s=t(67597),l=t.n(s),c=t(29766),o=t(22155),u=t(32793),d=t(48747),m=t(83043),p=t(521);function h(e,r){return u.cz.apply(void 0,(0,a._)(e.sub500nm.map(function(e){return(0,u.Tc)(e.value,e.diameterMidpointNm,e.calibrationIndex,r)})))}let f=function(){var e,r=(0,c.useRouter)(),t=(0,p.xw)(),s=t.value.luggage;if(!s)return console.warn("missing miniwras luggage data, sending user to homepage"),r.replace("/"),null;var f=(0,n._)(o.useState(0),2),v=f[0],b=f[1],x=s.features,N=(0,n._)((0,o.useState)((null===(e=x[v])||void 0===e?void 0:e.properties.pm05Naive)||0),2),y=N[0],_=N[1],j=o.useMemo(function(){return x.map(function(e,r){var t=u.cz.apply(void 0,(0,a._)(e.properties.channels.sub3000nm.map(function(e){return(0,u.dT)(e.value,e.diameterMidpointNm,e.calibrationIndex)})));return e.properties.pm_2_5/t})},[x]),M=o.useMemo(function(){return g(j)},[j]),w=o.useMemo(function(){var e,r;return e=j.length,r=g(j),Math.sqrt(j.map(function(e){return Math.pow(e-r,2)}).reduce(function(e,r){return e+r})/e)},[j]),T=o.useMemo(function(){var e=x[v].properties;return y/u.cz.apply(void 0,(0,a._)(e.channels.sub500nm.map(function(e){return(0,u.dT)(e.value,e.diameterMidpointNm,e.calibrationIndex)})))},[y,x,v]);return x.forEach(function(e){var r,t=e.properties;t.pm01To03Derived=(r=t.channels,u.cz.apply(void 0,(0,a._)(r.all.filter(function(e){return e.diameterMidpointNm>=100&&e.diameterMidpointNm<=300}).map(function(e){return(0,u.Tc)(e.value,e.diameterMidpointNm,e.calibrationIndex,M)})))),t.pm05Calibrated=h(t.channels,T),t.pm05To3Calibrated=t.pm_2_5-t.pm05Calibrated,t.pm05Derived=h(t.channels,M)}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"mt-4 mr-2",htmlFor:"reference",children:"Calibration Sample:"}),(0,i.jsx)("select",{onChange:function(e){b(parseInt(e.currentTarget.value,10))},children:x.map(function(e,r){return(0,i.jsx)("option",{value:r,children:r},r)})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"mr-2",htmlFor:"reference",children:"0.5 \xb5g/m\xb3 reference:"}),(0,i.jsx)(m.A,{name:"reference",label:"0.5 microgram per cubic meter reference",type:"number",onChange:function(e){try{_(parseFloat(e.currentTarget.value))}catch(e){}},defaultValue:y})]}),(0,i.jsxs)("table",{className:"mt-2",children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"RHO_DERIVED (PM2.5) MEAN"}),(0,i.jsx)("th",{className:"p-1",children:"RHO_DERIVED (PM2.5) STD_DEV"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"p-1",children:M.toFixed(2)}),(0,i.jsx)("td",{className:"p-1",children:w.toFixed(2)})]})]}),(0,i.jsxs)("table",{className:"mt-2",children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"RHO_GRIMM (PM0.5, kg/m3, Grimm)"}),(0,i.jsx)("th",{className:"p-1",children:"RHO_PM05_CALIBRATED (PM0.5, kg/m3)"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"p-1",children:u.bl.toFixed(2)}),(0,i.jsx)("td",{className:"p-1",children:T.toFixed(2)})]}),(0,i.jsx)("tr",{})]}),(0,i.jsx)("br",{}),(0,i.jsx)("div",{children:(0,i.jsx)(d.A,{onClick:function(){t.update(t.value),r.push("/map")},children:"Continue"})}),(0,i.jsx)("br",{}),(0,i.jsx)(l(),{children:(0,i.jsx)("style",{children:"\ntable#caltab, th, td {\n  border: 1px solid black;\n}\n"})},"caltable"),(0,i.jsxs)("table",{className:"mt-2",id:"caltab",children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"Time"}),(0,i.jsx)("th",{className:"p-1",children:"RHO_DERIVED (PM2.5) \xb5g/m3"}),(0,i.jsx)("th",{className:"p-1",children:"Density \xb5g/m3 PM0.5 (naive)"}),(0,i.jsx)("th",{className:"p-1",children:"Density \xb5g/m3 PM0.5 (calibrated)"})]}),s.features.map(function(e,r){var t=e.properties,n=t.date,a=t.pm05Naive,s=t.pm05Calibrated;return(0,i.jsxs)("tr",{className:r===v?"bg-lime-200":"",children:[(0,i.jsx)("td",{className:"p-1",children:n.toLocaleTimeString()}),(0,i.jsx)("td",{className:"p-1",children:j[r].toFixed()}),(0,i.jsx)("td",{className:"p-1",children:a.toFixed(2)}),(0,i.jsx)("td",{className:"p-1",children:s.toFixed(2)})]},r)})]})]})};var g=function(e){return u.cz.apply(void 0,(0,a._)(e))/e.length}},48747:(e,r,t)=>{"use strict";t.d(r,{A:()=>c});var n=t(34618),a=t(58139),i=t(65723),s=t(70851);t(22155);var l={bg:"bg-gray-600 hover:bg-gray-700 focus:ring-gray-500 focus:ring-offset-gray-200",display:"flex"};let c=function(e){var r=e.styles,t=void 0===r?{}:r,c=t.bg,o=void 0===c?l.bg:c,u=t.display,d=void 0===u?l.display:u,m=e.type,p=e.className,h=(0,a._)(e,["styles","type","className"]),f=(0,s.A)(p,o,d,"py-2 px-4 justify-center items-center text-white transition ease-in duration-200 text-center text-base font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg",h.disabled?"bg-gray-400 hover:bg-gray-400 cursor-not-allowed":"");return(0,i.jsx)("button",(0,n._)({type:void 0===m?"button":m,className:f},h))}},83043:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var n=t(34618),a=t(58139),i=t(65723),s=t(70851);t(22155);let l=function(e){var r=e.error,t=e.className,l=(0,a._)(e,["error","className"]);return(0,i.jsx)("input",(0,n._)({className:(0,s.A)("rounded-lg border-transparent flex-1 appearance-none border border-gray-400 py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm text-base focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent",r?"border-red-600":void 0,t)},l))}},32793:(e,r,t)=>{"use strict";t.d(r,{bl:()=>s.RHO_GRIMM,kg:()=>i,cz:()=>s.sum,Tc:()=>s["toPartialμgPerM3"],dT:()=>s["toPartialμgPerM3SansRho"]});var n=t(34618),a=t(92831),i=function(e){var r=e.pocketlabs,t=void 0===r?[]:r,i=e.strava,s=e.miniwras,l=[],c=!0,o=!1,u=void 0;try{for(var d,m=s[Symbol.iterator]();!(c=(d=m.next()).done);c=!0){var p=d.value,h=p.date,f=function(e){for(;;){var r=i[0],t=null==r?void 0:r.date;if(!t||!r)return console.warn("no strava data, skipping, dropping miniwras point"),null;if(t<e)i.shift();else if(t.getTime()-e.getTime()<6e4)return i.shift(),r;else return console.warn("miniwras > 1 minute away from strava points, dropping miniwras point"),null}}(h),g=function(e){for(;;){var r=t[0],n=null==r?void 0:r.date;if(!n||!r)return null;if(n<e)t.shift();else if(n.getTime()-e.getTime()<6e4)return t.shift(),r;else return null}}(h);f&&l.push((0,a._)((0,n._)({latitude:f.lat,longitude:f.lon},f,p),{pm05Calibrated:-1,pm05Derived:-1,pm05To3Calibrated:-1,pm01To03Derived:-1,pocketlabsEntry:g||void 0}))}}catch(e){o=!0,u=e}finally{try{c||null==m.return||m.return()}finally{if(o)throw u}}return{type:"FeatureCollection",features:l.map(function(e){return{type:"Feature",geometry:{type:"Point",coordinates:[e.longitude,e.latitude]},properties:e}})}},s=t(58875)},58875:(e,r,t)=>{"use strict";t.r(r),t.d(r,{RHO_GRIMM:()=>l,parse:()=>f,sum:()=>o,toPartialμgPerM3:()=>m,toPartialμgPerM3SansRho:()=>p});var n=t(48967),a=t(65959),i=t(69152),s=t(12551),l=1800,c=[6.842765,7.1751666,7.0114602,6.9088991,7.0263146,6.9180838,7.0393966,6.989318,6.9812267,5.2701795,14.0655402,13.8262107,14.1929174,14.0017841,13.8883794,13.9963284,14.0409634,14.2779903,13.8513492,13.898864,13.6873067,14.3390373,13.8184393,14.1478588,14.0655395,13.8262102,14.1929179,13.8296286,14.062005,13.9963317,14.040958,14.001345,13.96783,14,13.95533,14.00924,14,14,14,14,14],o=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.reduce(function(e,r){return e+r},0)},u=function(e){return e/1e9},d=function(e){return 1e6*e},m=function(e,r,t,n){return d(e)/c[t]*(Math.PI/6)*Math.pow(u(r),3)*n*(1e9/1)},p=function(e,r,t){return d(e)/c[t]*(Math.PI/6)*Math.pow(u(r),3)*(1e9/1)},h={date:function(e){return new Date(e.trim().split(" ").map(function(e,r){if(0===r){var t=(0,s._)(e.split("/"),3),n=t[0],a=t[1],i=t[2],l=function(e){return 1===e.length?"0".concat(e):e};return"".concat(n,"-").concat(l(a),"-").concat(l(i))}return"T".concat(e,".000+01:00")}).join(""))},pm_2_5:function(e){var r=parseFloat(e);return Number.isNaN(r)?(console.error("Expected a number, got a NaN. MiniWras export problem?"),0):r}},f=function(){var e=(0,n._)(function(e){var r,t,n,s,c,o,u=arguments;return(0,a.YH)(this,function(a){switch(a.label){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{records:[],partial:"",particleDiametersAscending:[]},[4,e.read()];case 1:return n=(t=a.sent()).done,((s=t.value)||n)&&(r.partial+="string"==typeof s?s:s?new TextDecoder().decode(s):"",o=(c=r.partial.split(/\n/g).map(function(e){return e.trim()}).filter(function(e){return!!e})).length-1,c.forEach(function(e,t){if(o!==t||n){var a=e.includes(",")?e.split(","):e.split("	");if(r.headerIndiciesByName){var s=a[r.headerIndiciesByName.Time],c=a[r.headerIndiciesByName["pm2.5 [ug/m3]"]];(0,i.V)(s,"date missing"),(0,i.V)(Number.isFinite(c),"column 'pm2.5 [ug/m3]' missing");for(var u=0,d=r.headerIndiciesByName["10.00 nm"],p=r.headerIndiciesByName["449.48 nm"],f=r.headerIndiciesByName["3238.77 nm"],g=[],v=0,b={all:[],sub500nm:[],sub3000nm:[]};d<f;){var x=parseFloat(a[d]),N=(r.particleDiametersAscending[v]+r.particleDiametersAscending[v+1])/2,y={value:x,diameterMidpointNm:N,calibrationIndex:v};b.all.push(y);var _=m(x,N,v,l);d<p&&(b.sub500nm.push(y),u+=_),d<f&&b.sub3000nm.push(y),++d,++v}console.log({sampleNum:r.records.length,pm05:u,debug:g}),r.records.push({channels:b,date:h.date(s),debug:g,pm05EndCol:p,pm05Naive:u,pm_2_5:h.pm_2_5(c)}),n&&(r.partial="")}else r.headerCells=a,r.headerIndiciesByName=a.reduce(function(e,t,n){var a=t.trim();e[a]=n;var i=a.match(/\s*(\d+\.\d+)\s+nm/);return i&&r.particleDiametersAscending.push(parseInt(i[1],10)),e},{})}else r.partial=e})),[2,n?r:f(e,r)]}})});return function(r){return e.apply(this,arguments)}}()},69152:(e,r,t)=>{"use strict";function n(e,r){if(null==e)throw Error(r)}t.d(r,{V:()=>n})}},e=>{var r=r=>e(e.s=r);e.O(0,[636,593,792],()=>r(48313)),_N_E=e.O()}]);