"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{2454:function(r,t,n){n.d(t,{Ok:function(){return o},Hw:function(){return c},e5:function(){return u}});var e=n(6930);function a(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);e=!0);}catch(c){a=!0,i=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw i}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(r){try{var t=new URL(r),n=a(t.pathname.substr(1).split("/"),3),e=n[0],i=n[1],o=n[2];if("spreadsheets"===e&&"d"===i&&o&&t.host.match("google.com"))return!0}catch(u){}return!1}function u(r){var t=new URL(r);return t.pathname=i(t.pathname.substr(1).split("/").splice(0,3)).concat(["export"]).join("/"),String(t)}var c=function(r){var t=new URL(r),n=new URLSearchParams(t.search);return n.has("format")||n.set("format","csv"),t.search=n.toString(),function(r,t){return fetch(r,t).then((function(r){return r.body})).then((function(r){var t=null===r||void 0===r?void 0:r.getReader();return(0,e.k)(t,"missing stream body"),t}))}(u(t.toString()),{mode:"cors",redirect:"follow",headers:{accept:"text"}})}},4849:function(r,t,n){function e(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);e=!0);}catch(c){a=!0,i=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw i}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.d(t,{q:function(){return a}});var a=function(r){return function(t){var n=e(t,2),a=n[0],i=n[1];return["all",[">=",r,a],["<",r,i]]}}},3460:function(r,t,n){n.r(t),n.d(t,{getResources:function(){return F}});var e={};n.r(e),n.d(e,{parse:function(){return y}});var a={};n.r(a),n.d(a,{getLevels:function(){return M},getLevelsByField:function(){return L},getLevelsSub500nm:function(){return D}});var i=n(4235),o=n.n(i),u=n(2454),c=n(6930);function l(r,t,n,e,a,i,o){try{var u=r[i](o),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(e,a)}function f(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);e=!0);}catch(c){a=!0,i=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw i}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s,d=[6.842765,7.1751666,7.0114602,6.9088991,7.0263146,6.9180838,7.0393966,6.989318,6.9812267,5.2701795,14.0655402,13.8262107,14.1929174,14.0017841,13.8883794,13.9963284,14.0409634,14.2779903,13.8513492,13.898864,13.6873067,14.3390373,13.8184393,14.1478588,14.0655395,13.8262102,14.1929179,13.8296286,14.062005,13.9963317,14.040958,14.001345,13.96783,14,13.95533,14.00924,14,14,14,14,14],p=function(r,t,n){return 1800*(1e6*r/n*(Math.PI/6)*Math.pow(t/1e9,3))*1e9},m=function(r){return new Date(r.trim().split(" ").map((function(r,t){if(0===t){var n=f(r.split("/"),3),e=n[0],a=n[1],i=n[2],o=function(r){return 1===r.length?"0".concat(r):r};return"".concat(e,"-").concat(o(a),"-").concat(o(i))}return"T".concat(r,".000+01:00")})).join(""))},v=function(r){return parseFloat(r)},y=(s=o().mark((function r(t,n){var e,a,i,u,l,f,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=void 0===n?{records:[],partial:"",particleDiametersAscending:[]}:n,r.next=3,t.read();case 3:return a=r.sent,i=a.done,((u=a.value)||i)&&(e.partial+="string"===typeof u?u:u?(new TextDecoder).decode(u):"",l=e.partial.split(/\n/g),f=l.map((function(r){return r.trim()})).filter((function(r){return!!r})),s=f.length-1,f.forEach((function(r,t){if(s!==t||i){var n=r.includes(",")?r.split(","):r.split("\t");if(e.headerIndiciesByName){var a=n[e.headerIndiciesByName.Time],o=n[e.headerIndiciesByName["pm2.5 [ug/m3]"]];(0,c.k)(a,"date missing"),(0,c.k)(Number.isFinite(o),"column 'pm2.5 [ug/m3]' missing");for(var u=0,l=e.headerIndiciesByName["10.00 nm"],f=e.headerIndiciesByName["449.48 nm"],y=0,h=[],g=0;l<f;){var b,w=parseFloat(n[l]),A=(e.particleDiametersAscending[y]+e.particleDiametersAscending[y+1])/2;++g;var O=d[g],S=p(w,A,O);h.push({calibrationDivisor:O,diameterHeader:(null===(b=e.headerCells)||void 0===b?void 0:b[l])||"",diameterMidpointNm:A,"\u03bcg":S,numParticles:w}),u+=S,++y,++l}console.log({sampleNum:e.records.length,sub500nm:u,debug:h}),e.records.push({date:m(a),sub500nm:u,pm_2_5:v(o)}),i&&(e.partial="")}else e.headerCells=n,e.headerIndiciesByName=n.reduce((function(r,t,n){var a=t.trim();r[a]=n;var i=a.match(/\s*(\d+\.\d+)\s+nm/);return i&&e.particleDiametersAscending.push(parseInt(i[1],10)),r}),{})}else e.partial=r}))),r.abrupt("return",i?e:y(t,e));case 8:case"end":return r.stop()}}),r)})),function(){var r=this,t=arguments;return new Promise((function(n,e){var a=s.apply(r,t);function i(r){l(a,n,e,i,o,"next",r)}function o(r){l(a,n,e,i,o,"throw",r)}i(void 0)}))}),h=n(9857);function g(r,t,n,e,a,i,o){try{var u=r[i](o),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(e,a)}function b(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function w(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter((function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})))),e.forEach((function(t){b(r,t,n[t])}))}return r}function A(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);e=!0);}catch(c){a=!0,i=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw i}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var O=function(r){var t=function(r){return function(){var t=this,n=arguments;return new Promise((function(e,a){var i=r.apply(t,n);function o(r){g(i,e,a,o,u,"next",r)}function u(r){g(i,e,a,o,u,"throw",r)}o(void 0)}))}}(o().mark((function t(n){var e,a,i,l,f,s,d,p,m;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=A(n,2),a=e[0],i=e[1],(0,c.k)(a,""),(0,c.k)(i,""),t.t0=A,t.next=6,Promise.all([(0,u.Hw)(a).then(y),(0,u.Hw)(i).then(h.parse)]);case 6:return t.t1=t.sent,l=(0,t.t0)(t.t1,2),f=l[0],s=f.records,d=l[1],p=d.records,s.length!==p.length&&console.warn("lossy data - measures ".concat(s.length,", positions ").concat(p.length)),m=p.map((function(r){return r.date})),t.abrupt("return",s.reduce((function(t,n){var e=r.closestTo(n.date,m),a=p.find((function(r){return r.date.getTime()===e.getTime()}));if(!a)throw new Error("no position found for ".concat(JSON.stringify(n)));var i=w({},n,{latitude:a.latitude,longitude:a.longitude,humidity:a.humidity,pocketlabsEntry:a,skip:Math.abs(a.date.getTime()-n.date.getTime())>6e4});return i.skip||t.push(i),t}),[]));case 15:case"end":return t.stop()}}),t)}))),n=function(r){return{type:"FeatureCollection",features:r.map((function(r){return{type:"Feature",geometry:{type:"Point",coordinates:[r.lon,r.lat]},properties:w({},r)}}))}};return{combine:function(r){var t=r.pocketlabs,e=void 0===t?[]:t,a=r.strava,i=r.miniwras,o=function(r){for(;;){var t=a[0],n=null===t||void 0===t?void 0:t.date;if(!n||!t)return console.warn("no strava data, skipping, dropping miniwras point"),null;if(!(n<r))return n.getTime()-r.getTime()<6e4?(a.shift(),t):(console.warn("miniwras > 1 minute away from strava points, dropping miniwras point"),null);a.shift()}},u=function(r){for(;;){var t=e[0],n=null===t||void 0===t?void 0:t.date;if(!n||!t)return null;if(!(n<r))return n.getTime()-r.getTime()<6e4?(e.shift(),t):null;e.shift()}},c=[],l=!0,f=!1,s=void 0;try{for(var d,p=i[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var m=d.value,v=m.date,y=o(v),h=u(v);y&&c.push(w({},y,m,{pocketlabs:h||void 0}))}}catch(g){f=!0,s=g}finally{try{l||null==p.return||p.return()}finally{if(f)throw s}}return n(c)},download:t,downloadGeoJSON:function(r){},dateField:"date",toGeoJSON:n}},S=n(4849);function P(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function j(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var x,N=["#6fc400","#feff00","#ffaa00","#ff5600","#991113","#4d0173","black"],k="pm_2_5",T="sub500nm",I=[0,.25,.5,1,2.5,5,20].map((function(r,t,n){return[r,n[t+1]||1/0]})),_=["get",k],E=["get",T],M=function(r){var t=r.isMinMaxDynamicRange,n=r.geojson,e=0,a=1/0,i=-1/0,o=!0,u=!1,c=void 0;try{for(var l,f=n.features[Symbol.iterator]();!(o=(l=f.next()).done);o=!0){(e=l.value.properties.pm_2_5)>i&&(i=e),e<a&&(a=e)}}catch(m){u=!0,c=m}finally{try{o||null==f.return||f.return()}finally{if(u)throw c}}var s=N.length,d=t?(i-a)/s:0,p=t?j(new Array(s)).map((function(r,t){var n=a+t*d;return[n,n+d]})):I;return{circleCases:p.map((0,S.q)(_)).flatMap((function(r,t){return[r,N[t]]})),colors:N,fieldName:k,ranges:p}},D=function(r){var t=r.isMinMaxDynamicRange,n=r.geojson,e=0,a=1/0,i=-1/0,o=!0,u=!1,c=void 0;try{for(var l,f=n.features[Symbol.iterator]();!(o=(l=f.next()).done);o=!0){(e=l.value.properties.sub500nm)>i&&(i=e),e<a&&(a=e)}}catch(m){u=!0,c=m}finally{try{o||null==f.return||f.return()}finally{if(u)throw c}}var s=N.length,d=t?(i-a)/s:0,p=t?j(new Array(s)).map((function(r,t){var n=a+t*d;return[n,n+d]})):I;return{circleCases:p.map((0,S.q)(E)).flatMap((function(r,t){return[r,N[t]]})),colors:N,fieldName:T,ranges:p}},L=(P(x={},k,M),P(x,"sub500nm \u03bcg/m^3",D),x),F=function(r){return{download:O(r),mapbox:a,stream:e}}},9857:function(r,t,n){n.r(t),n.d(t,{parse:function(){return A}});var e,a,i=n(4235),o=n.n(i);function u(r,t,n,e,a,i,o){try{var u=r[i](o),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(e,a)}function c(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function l(r){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},e=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(n).filter((function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable})))),e.forEach((function(t){c(r,t,n[t])}))}return r}function f(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);e=!0);}catch(c){a=!0,i=c}finally{try{e||null==u.return||u.return()}finally{if(a)throw i}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(r,t){if(null===r||void 0===r)throw Error(t)}var p,m=new Set(s(["Date","Lat","Lng","PM1.0 (\xb5g/m\xb3)","PM2.5 (\xb5g/m\xb3)","t (s)"]).concat(s(["Lat","Lng","t (s)","Relative Humidity (%)"]))),v={Date:"date",Lat:"latitude",Lng:"longitude","t (s)":"counter_t","PM1.0 (\xb5g/m\xb3)":"pm_1_0","PM2.5 (\xb5g/m\xb3)":"pm_2_5","Relative Humidity (%)":"humidity"},y={Date:function(r){return new Date(r)},Lat:parseFloat,Lng:parseFloat,"t (s)":function(r){return parseInt(r)},"PM1.0 (\xb5g/m\xb3)":parseFloat,"PM2.5 (\xb5g/m\xb3)":parseFloat,"Relative Humidity (%)":parseFloat},h=["a","A","z","Z"],g=(e=Math).min.apply(e,s(h.map((function(r){return r.charCodeAt(0)})))),b=(a=Math).max.apply(a,s(h.map((function(r){return r.charCodeAt(0)})))),w=function(r){var t=r.charCodeAt(0);return g<=t&&t<=b},A=(p=o().mark((function r(t,n){var e,a,i,u,s,p;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=void 0===n?{headerIndiciesByName:{},partial:"",records:[]}:n,r.next=3,t.read();case 3:return a=r.sent,i=a.done,u=a.value,e.partial+="string"===typeof u?u:u?(new TextDecoder).decode(u):"",s=e.partial.split(/\n/g),p=s.length-1,s.forEach((function(r,t){if(p!==t||i){var n=r.split(",").map((function(r){return r.trim()}));if(w(r[0]||""))e.headerIndiciesByName=n.reduce((function(r,t,n){return m.has(t)?l({},r,c({},t,n)):r}),{});else if(""===n[0]);else{var a=Object.entries(e.headerIndiciesByName).reduce((function(r,t){var e=f(t,2),a=e[0],i=e[1];return l({},r,c({},v[a],y[a](n[i])))}),{});d(!Number.isNaN(a.counter_t),"NaN"),d(Number.isFinite(a.counter_t),"t (s) not ok"),e.records[a.counter_t]=l({},e.records[a.counter_t]||{},a),i&&(e.partial="")}}else e.partial=r})),r.abrupt("return",i?e:A(t,e));case 11:case"end":return r.stop()}}),r)})),function(){var r=this,t=arguments;return new Promise((function(n,e){var a=p.apply(r,t);function i(r){u(a,n,e,i,o,"next",r)}function o(r){u(a,n,e,i,o,"throw",r)}i(void 0)}))})},6930:function(r,t,n){function e(r,t){if(null===r||void 0===r)throw Error(t)}n.d(t,{k:function(){return e}})}}]);